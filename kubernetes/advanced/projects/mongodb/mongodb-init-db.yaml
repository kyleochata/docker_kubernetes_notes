apiVersion: v1
kind: ConfigMap
metadata:
  name: mongodb-init-config
  labels:
    app: mongodb
data:
  monog-init.js: |
    const dbName = process.env.DB_NAME
    const dbUser = process.env.DB_USER
    const dbPassword = process.env.DB_PASSWORD

    // Get the db named 'key-value-db'
    db = db.getSiblingDB(dbName)

    console.log(`INITIALIZING: ${dbName}`)
    console.log(`INITIALIZING: Creating user: ${dbUser}`)

    // Create a suser with the role of readWrite for key-value-db
    db.createUser({
        user: dbUser,
        pwd: dbPassword,
        roles: [
            {
                role: 'readWrite',
                db: dbName
            }
        ]
    })
    console.log(`INITIALIZING: Success`)
